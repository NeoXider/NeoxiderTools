# Интерфейс IPoolable

## 1. Введение

`IPoolable` — это простой, но мощный интерфейс, который позволяет вашим компонентам "узнавать" о своем жизненном цикле внутри системы пулинга. Когда вы реализуете этот интерфейс на любом из компонентов вашего префаба, `PoolManager` будет автоматически вызывать его методы в ключевые моменты: при создании, при получении из пула и при возврате в пул.

Это позволяет вам безопасно и эффективно управлять состоянием объекта, сбрасывая его к значениям по умолчанию перед повторным использованием.

---

## 2. Описание интерфейса

- **Пространство имен**: `Neo.Tools`
- **Путь к файлу**: `Assets/Neoxider/Scripts/Tools/Spawner/IPoolable.cs`

### Методы интерфейса

#### `void OnPoolCreate()`
- **Когда вызывается**: **Один раз** за всю жизнь объекта, в момент его самого первого создания через `Instantiate`.
- **Назначение**: Идеально подходит для операций, которые нужно выполнить только один раз, например, для кэширования ссылок на компоненты (`GetComponent`, `GetComponentInChildren`). Это позволяет избежать многократного поиска компонентов в методе `OnPoolGet`.

#### `void OnPoolGet()`
- **Когда вызывается**: **Каждый раз**, когда объект извлекается из пула с помощью `PoolManager.Get()`.
- **Назначение**: Это самый важный метод для сброса состояния. Здесь вы должны вернуть объект к его первоначальному виду, как будто он только что был создан. Примеры:
  - Восстановить здоровье до максимума.
  - Сбросить таймеры.
  - Включить `TrailRenderer` и другие визуальные эффекты.
  - Вернуть физическому телу начальную скорость.

#### `void OnPoolRelease()`
- **Когда вызывается**: **Каждый раз**, когда объект возвращается в пул через `PoolManager.Release()`.
- **Назначение**: Используется для "безопасного отключения" объекта перед тем, как он станет неактивным. Примеры:
  - Остановить проигрывание звуков или партиклов.
  - Отписаться от событий, чтобы избежать утечек памяти.

---

## 3. Пример реализации

Предположим, у нас есть скрипт для пули `Bullet.cs`.

```csharp
using UnityEngine;
using Neo.Tools; // Не забудьте подключить пространство имен

public class Bullet : MonoBehaviour, IPoolable
{
    public float speed = 10f;
    public float lifetime = 3f;

    private Rigidbody rb;
    private TrailRenderer trail;
    private float lifeTimer;

    // 1. Вызывается один раз при создании
    public void OnPoolCreate()
    {
        // Кэшируем компоненты здесь
        rb = GetComponent<Rigidbody>();
        trail = GetComponent<TrailRenderer>();
        Debug.Log("Новый экземпляр пули создан и добавлен в пул.");
    }

    // 2. Вызывается каждый раз, когда пулю достают из пула
    public void OnPoolGet()
    {
        // Сбрасываем состояние
        lifeTimer = lifetime;
        rb.velocity = Vector3.zero;
        rb.angularVelocity = Vector3.zero;
        if (trail != null) trail.Clear(); // Очищаем хвост от трейла

        // Запускаем логику
        rb.AddForce(transform.forward * speed, ForceMode.Impulse);
    }

    // 3. Вызывается каждый раз, когда пулю возвращают в пул
    public void OnPoolRelease()
    {
        // Здесь можно что-то отключить, если это необходимо
        // Например, остановить звук полета пули
    }

    void Update()
    {
        lifeTimer -= Time.deltaTime;
        if (lifeTimer <= 0f)
        {
            // Возвращаем пулю в пул, когда ее время жизни истекло
            PoolManager.Release(this.gameObject);
        }
    }
}
```
