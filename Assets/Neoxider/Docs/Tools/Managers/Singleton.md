# Базовый класс Singleton<T>

## 1. Введение

Паттерн "Одиночка" (Singleton) — это способ гарантировать, что у класса в игре будет только один экземпляр, и предоставить к нему простую глобальную точку доступа. Это идеально подходит для таких систем, как `GameManager`, `EventManager`, `ScoreManager` и т.д.

`Singleton<T>` — это абстрактный generic-класс, который берет на себя всю сложную логику реализации этого паттерна. Вам не нужно писать код для поиска экземпляра, проверки на дубликаты или сохранения объекта между сценами — достаточно просто унаследовать свой класс от `Singleton<T>`.

---

## 2. Описание класса

### Singleton<T>
- **Пространство имен**: `Neo.Tools`
- **Путь к файлу**: `Assets/Neoxider/Scripts/Tools/Managers/Singleton.cs` (имя файла с опечаткой)

**Описание**
Это базовый класс, от которого должны наследоваться все ваши менеджеры-синглтоны. **Не добавляйте этот компонент на объекты напрямую!**

- `_dontDestroyOnLoad`: `bool` - Если `true`, объект-синглтон не будет уничтожаться при загрузке новых сцен. Настраивается в инспекторе.
- `_setInstanceOnAwake`: `bool` - Если `true` (по умолчанию), экземпляр синглтона будет установлен в методе `Awake()`. Рекомендуется для большинства случаев. Настраивается в инспекторе.

### Публичные статические поля и свойства
- `CreateInstance`: `bool` - **(Статическое)** Если `true`, и экземпляр синглтона не найден на сцене при первом обращении к `I`, будет автоматически создан новый GameObject с компонентом синглтона. По умолчанию `false`.
- `I`: `T` - **(Статическое свойство)** Основная точка доступа к единственному экземпляру синглтона. При первом обращении:
    1. Ищет **все** экземпляры типа T на сцене и выбирает **первый, у кого включён Set Instance On Awake**. Если ни у одного флаг не включён — экземпляр не назначается (назначится в Awake того объекта, у кого флаг включён).
    2. Если не найден подходящий и `CreateInstance` равно `true`, создает новый GameObject и добавляет компонент синглтона.
    3. Инициализирует синглтон, вызывая `Init()`, если он еще не был инициализирован.
- `IsInitialized`: `bool` - **(Статическое свойство)** Возвращает `true`, если экземпляр синглтона уже существует и инициализирован.

**Ключевые возможности** 
- **Глобальный доступ**: Любой унаследованный менеджер (например, `MyManager`) будет доступен из любой точки кода через статическое свойство `MyManager.I`.
- **Защита от дубликатов**: Если на сцене несколько экземпляров, синглтоном становится тот, у кого включён **Set Instance On Awake** (остальные с этим флагом при Awake удалятся). Для нескольких экземпляров с разной логикой (например Money для монет и Money для энергии) у «главного» включите Set Instance On Awake, у остальных выключите — обращение к ним только по ссылке (например поле Money Source в TextMoney).
- **Сохранение между сценами**: Если в инспекторе вашего менеджера включить флаг `_dontDestroyOnLoad`, он не будет уничтожаться при загрузке новых сцен.

**Методы для переопределения**
Вместо `Awake()` в ваших синглтонах следует использовать эти виртуальные методы:
- `Init()`: Этот метод вызывается один раз, когда синглтон инициализируется (либо в `Awake`, либо при первом обращении к нему). Помещайте сюда всю вашу логику инициализации.
- `OnInstanceCreated()`: Вызывается только в том случае, если экземпляр синглтона был создан динамически (не был размещен на сцене заранее).

---

## 3. Как использовать

Чтобы создать свой собственный синглтон, следуйте этому примеру:

1.  Создайте новый C# скрипт, например, `MyManager.cs`.
2.  Измените его код так, чтобы он наследовался от `Singleton<MyManager>`:

    ```csharp
    using Neo.Tools;
    using UnityEngine;

    // 1. Указываем, что MyManager наследуется от Singleton<MyManager>
    public class MyManager : Singleton<MyManager>
    {
        // 2. Переопределяем Init() для своей логики инициализации
        protected override void Init()
        {
            base.Init(); // Хорошей практикой будет вызвать базовый метод
            Debug.Log("MyManager инициализирован!");
        }

        // 3. Добавляем свои собственные публичные методы
        public void DoSomething()
        {
            Debug.Log("MyManager делает что-то важное!");
        }
    }
    ```
3.  Добавьте компонент `MyManager` на объект на сцене.
4.  Теперь из любого другого скрипта вы можете легко к нему обратиться:

    ```csharp
    void Start()
    {
        // Вызываем публичный метод нашего синглтона
        MyManager.I.DoSomething();
    }
    ```
