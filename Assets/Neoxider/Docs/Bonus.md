# Документация по системе бонусов

Модуль **Bonus** предоставляет набор готовых к использованию бонусных игровых механик, которые можно легко интегрировать в ваш проект. Сюда входят Колесо Фортуны, слот-машина, система коллекционирования предметов и временные награды. Эти инструменты помогают повысить вовлеченность и удержание игроков.

## Основные бонусные механики

### Колесо Фортуны (`WheelFortune`)
**Пространство имен:** `Neo.Bonus`
**Путь:** `Scripts/Bonus/WheelFortune/WheelFortune.cs`

Реализует механику "Колеса Фортуны". Позволяет игроку вращать колесо для получения случайного приза из предопределенного набора.

**Ключевые особенности:**
- Настраиваемая скорость вращения и замедления.
- Автоматическое или ручное расположение призов по кругу.
- Опциональное выравнивание колеса для точной остановки на секторе.

**Публичные свойства и поля (Public Properties and Fields):**
- `SpinState State { get; }`: Возвращает текущее состояние колеса (`Idle`, `Spinning`, `Decelerating`, `Aligning`).
- `GameObject[] Items { get; }`: Возвращает массив игровых объектов, являющихся призами.
- `bool canUse { get; set; }`: Определяет, можно ли использовать колесо. При установке `false` в одноразовом режиме (`singleUse`) повторное вращение будет невозможным.

**Публичные методы:**
- `Spin()`: Начинает вращение колеса.
- `Stop()`: Инициирует остановку колеса.
- `GetPrize(int id)`: Возвращает игровой объект приза по его ID.

**Unity Events:**
- `OnWinIdVariant (int)`: Вызывается после остановки колеса. Передает ID выигравшего элемента.

### Слот-машина (`SpinController`)
**Пространство имен:** `Neo.Bonus`
**Путь:** `Scripts/Bonus/Slot/SpinController.cs`

Полнофункциональная слот-машина. Управляет ставками, линиями, вращением барабанов и определением выигрышных комбинаций.

**Ключевые особенности:**
- Гибкая настройка через `ScriptableObject` (ставки, линии, символы, множители).
- Управление ставками и количеством активных линий.
- Контроль вероятности выигрыша.

**Публичные свойства и поля (Public Properties and Fields):**
- `float chanseWin`: Вероятность выигрыша от 0 до 1.
- `IMoneySpend moneySpend`: Реализация интерфейса для списания средств за спин.
- `int[,] FinalElementIDs`: Возвращает двумерный массив ID элементов, которые будут показаны после остановки барабанов.

**Публичные методы:**
- `StartSpin()`: Запускает вращение барабанов.
- `IsStop()`: Возвращает `true`, если все барабаны остановились.
- `AddLine()` / `RemoveLine()`: Изменяет количество активных линий.
- `AddBet()` / `RemoveBet()`: Изменяет текущую ставку.
- `SetMaxBet()`: Устанавливает максимальную ставку.

**Unity Events:**
- `OnStartSpin`: Вызывается в момент начала вращения.
- `OnEndSpin`: Вызывается после полной остановки всех барабанов и подсчета результатов.
- `OnEnd (bool)`: Вызывается в конце спина. Передает `true`, если был выигрыш, иначе `false`.
- `OnWin (int)`: Вызывается при выигрыше. Передает общую сумму выигрыша.
- `OnWinLines (int[])`: Вызывается при выигрыше. Передает массив ID выигрышных линий.
- `OnLose`: Вызывается при проигрыше.
- `OnChangeBet (string)`: Вызывается при изменении общей ставки. Передает сумму ставки в виде строки.
- `OnChangeMoneyWin (string)`: Вызывается при выигрыше. Передает сумму выигрыша в виде строки.

### Временная награда (`TimeReward`)
**Пространство имен:** `Neo.Bonus`
**Путь:** `Scripts/Bonus/TimeReward/TimeReward.cs`

Реализует систему, в которой игрок может получить награду по истечении определенного времени.

**Ключевые особенности:**
- Настраиваемый период ожидания награды.
- Сохранение времени последней полученной награды в `PlayerPrefs`.

**Публичные свойства и поля (Public Properties and Fields):**
- `float timeLeft`: Оставшееся время до получения награды в секундах.

**Публичные методы:**
- `TakeReward()`: Попытка забрать награду. Возвращает `true` в случае успеха.
- `Take()`: Альтернативный метод для вызова `TakeReward()` (например, с кнопок Unity).
- `CanTakeReward()`: Проверяет, доступна ли награда в данный момент. Возвращает `true`, если награду можно забрать.
- `GetSecondsUntilReward()`: Возвращает оставшееся время до следующей награды в секундах.
- `static string FormatTime(int seconds)`: Форматирует время из секунд в строку формата `hh:mm:ss`.

**Unity Events:**
- `OnTimeUpdated (float)`: Вызывается каждую секунду. Передает оставшееся время до награды.
- `OnRewardClaimed`: Вызывается в момент успешного получения награды.
- `OnRewardAvailable`: Вызывается один раз, когда таймер доходит до нуля и награда становится доступной.

### Система коллекций (`Collection`)
**Пространство имен:** `Neo.Bonus`
**Путь:** `Scripts/Bonus/Collection/Collection.cs`

Управляет системой коллекционирования предметов. Отслеживает, какие предметы уже разблокированы, и выдает новые в качестве призов.

**Ключевые особенности:**
- Хранение данных о предметах в `ScriptableObject` (`ItemCollectionData`).
- Сохранение прогресса разблокировки в `PlayerPrefs`.

**Публичные свойства и поля (Public Properties and Fields):**
- `static Collection Instance`: Статический экземпляр класса для глобального доступа.
- `ItemCollectionData[] itemCollectionDatas`: Массив данных о всех предметах коллекции.
- `bool[] enabledItems`: Массив, показывающий, какие предметы разблокированы (`true`).

**Публичные методы:**
- `GetPrize()`: Возвращает `ItemCollectionData` нового уникального предмета и сохраняет прогресс.

**Unity Events:**
- `OnGetItem (int)`: Вызывается при получении нового предмета. Передает ID предмета.
- `OnLoadItems`: Вызывается после загрузки данных о коллекции из сохранений.

### Линейная рулетка (`LineRoulett`)
**Пространство имен:** `Neo.Bonus`
**Путь:** `Scripts/Bonus/LineRoulett.cs`

Создает визуальную рулетку в виде горизонтально движущейся ленты с призами. Игрок запускает вращение, и после остановки определяется приз, оказавшийся под стрелкой.

**Ключевые особенности:**
- Настраиваемая скорость, время вращения и замедления.
- Простое добавление призов через массив спрайтов.

**Публичные свойства и поля (Public Properties and Fields):**
- `Sprite[] sprites`: Массив спрайтов, которые используются для отображения призов в рулетке.
- `bool updateSetting`: Флаг для принудительного обновления визуального расположения элементов в редакторе Unity при значении `true`.

**Публичные методы:**
- `StartRolling()`: Запускает вращение рулетки.

**Unity Events:**
- `OnWin (int)`: Вызывается после остановки рулетки. Передает ID выигравшего спрайта из массива `sprites`.
