# ParallaxLayer — универсальный модуль параллакса

`ParallaxLayer` — переиспользуемый компонент для 2D‑сцен Unity. Скрипт автоматически раскладывает тайлы вокруг камеры, двигает их с учётом параллакса и переиспользует, чтобы фон оставался бесшовным. Благодаря предпросмотру в редакторе можно сразу увидеть результат без запуска Play Mode.

## Возможности
- **Параллакс** — множители `parallaxMultiplier.x/y` определяют, насколько слой реагирует на движение камеры (0 – слой «приклеен», 1 – движется на ту же величину в противоположную сторону).
- **Автоскролл** — `scrollSpeed` добавляет постоянное движение в мировых координатах: фон может «плыть» даже если камера стоит.
- **Зазор между тайлами** — `tileSpacing` задаёт дополнительный отступ по X/Y (в мировых единицах). Полезно, когда тайлы не должны соприкасаться или нужно перекрытие.
- **Предпросмотр** — флаг `generateInEditor` включает генерацию тайлов прямо в сцене. При отключении все тайлы удаляются, а шаблонный `SpriteRenderer` снова активен.
- **Тайлинг по осям** — параметры `tileHorizontally` и `tileVertically` включают бегущую прокрутку по выбранным осям; `paddingTiles` добавляет запасные ряды вне экрана.
- **Минимальный пул** — генерируется только нужное количество тайлов; по мере выхода за пределы обзора они перекидываются на противоположную сторону.
- **Варианты спрайтов** — массив `spriteVariants` с переключателями `randomiseOnInit` и `randomiseOnRecycle` позволяет случайно чередовать изображения.
- **Подгонка размеров** — `fitToMaxSpriteSize` масштабирует тайлы под наиболее крупный спрайт, что исключает щели между ними.

## Настройка
1. Добавьте `ParallaxLayer` на объект со `SpriteRenderer`. Этот рендер выступает шаблоном (позиция — место «якоря», спрайт — базовый тайл).
2. При необходимости назначьте `targetCamera`. Если оставить поле пустым, компонент использует `Camera.main`.
3. Настройте `parallaxMultiplier` для каждого слоя (например, дальний фон 0.2, средний 0.5, передний 1.0).
4. Задайте `scrollSpeed`, если слой должен двигаться сам по себе.
5. При необходимости укажите `tileSpacing`, `tileHorizontally`/`tileVertically` и `paddingTiles`, чтобы контролировать плотность и запас тайлов.
6. Заполните `spriteVariants`, активируйте рандомизацию и `fitToMaxSpriteSize`, если используете спрайты разных размеров.
7. Оставьте `generateInEditor` включённым, чтобы видеть результат сразу. Когда нужно вручную поправить шаблон — временно отключите флаг, слой очистится до исходного рендера.

## Поведение
- При каждом переинициализировании компонент очищает старые тайлы (включая созданные в режиме предпросмотра) и создаёт новые. При запуске игры редакторский пул полностью перестраивается, так что лишних объектов не остаётся.
- В редакторе любое изменение сериализованных параметров вызывает пересборку слоя (если `generateInEditor` активен).
- Шаблонный `SpriteRenderer` хранит исходное положение/поворот/масштаб, поэтому начало слоя никогда не «прыгает» при старте.

## Советы
- Не ставьте слишком большие значения `paddingTiles`: каждый шаг добавляет новые тайлы по обе стороны сцены.
- Если нужны зазоры между тайлами, увеличьте `tileSpacing`; для перекрытия используйте отрицательные значения.
- Для Sprite Atlas лучше добавлять все варианты спрайтов, чтобы избежать переключения материалов.
- При перспективной камере задайте `targetCamera` явно и подберите `paddingTiles` экспериментально.

**Файлы:**
- Скрипт: `Assets/_source/Scripts/Parallax/ParallaxLayer.cs`
- Документация: `Assets/_source/Scripts/Parallax/ParallaxLayer.md`
