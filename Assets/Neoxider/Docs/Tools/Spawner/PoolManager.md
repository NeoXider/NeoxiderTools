# Менеджер пулов (PoolManager)

## 1. Введение

`PoolManager` — это центральный компонент (Singleton), который управляет всеми пулами объектов в вашей игре. Он спроектирован так, чтобы максимально упростить процесс получения и возврата объектов, скрывая всю сложность управления пулами.

Ключевая особенность — **гибкость**. Вы можете как заранее сконфигурировать пулы для важных объектов (пули, враги) с индивидуальными настройками, так и положиться на автоматическое создание пулов для менее критичных объектов.

---

## 2. Описание класса

### PoolManager
- **Пространство имен**: `Neo.Tools`
- **Путь к файлу**: `Assets/Neoxider/Scripts/Tools/Spawner/PoolManager.cs`
- **Наследуется от**: `Singleton<PoolManager>`

**Описание**
Централизованный сервис для управления жизненным циклом объектов, используемых в системе пулинга. Он не уничтожается при смене сцен, что делает его идеальным для управления объектами на протяжении всей игры.

### Ключевые особенности
- **Централизованный доступ**: Как Singleton, он предоставляет статические методы `Get()` и `Release()`, доступные из любой точки вашего кода.
- **Гибкая конфигурация**: Позволяет заранее настроить пулы с индивидуальными параметрами (начальный размер, расширение) через инспектор.
- **Автоматическое создание пулов**: Если для префаба нет предварительной конфигурации, `PoolManager` автоматически создаст для него пул с настройками по умолчанию.
- **Надежность при смене сцен**: `PoolManager` не уничтожается при загрузке сцен и автоматически очищает пулы, чтобы предотвратить утечки памяти.
- **Чистая иерархия**: Объекты, созданные без указания родителя, автоматически становятся дочерними для `PoolManager`, что предотвращает беспорядок в корне сцены.

---

## 3. Настройки в инспекторе

### 3.1. Настройки пула по умолчанию
- `_defaultInitialSize` (`int`): Начальный размер, который будет использоваться для пулов, создаваемых автоматически (для префабов, не указанных в списке ниже).
- `_defaultExpandPool` (`bool`): Если `true`, автоматически создаваемые пулы смогут расширяться.

### 3.2. Предварительные конфигурации пулов
- `_preconfiguredPools` (`List<PoolConfig>`): Список для детальной настройки пулов для конкретных префабов.
  - `prefab`: Префаб, для которого создается пул.
  - `initialSize`: Начальное количество объектов в этом пуле.
  - `expandPool`: Может ли этот конкретный пул расширяться.

---

## 4. Как использовать

1.  **Добавьте `PoolManager` на сцену**: Создайте пустой `GameObject` (например, с именем "--Services--") и добавьте на него компонент `PoolManager`. **Это нужно сделать только один раз на всю игру.**

2.  **(Опционально) Настройте пулы**: В инспекторе `PoolManager` заполните список `_preconfiguredPools` для тех префабов, которые требуют особых настроек (например, для пуль задайте большой начальный размер).

3.  **Получите объект из пула**: В любом месте вашего кода вызовите статический метод `Get()`. Вы можете сразу указать родительский `Transform`.
    ```csharp
    public GameObject bulletPrefab;
    public Transform bulletContainer;

    void Fire()
    {
        // Получаем пулю и сразу делаем ее дочерней для контейнера
        GameObject bulletInstance = PoolManager.Get(bulletPrefab, transform.position, transform.rotation, bulletContainer);

        // Если родитель не указан, объект будет дочерним для PoolManager
        GameObject effect = PoolManager.Get(effectPrefab, transform.position, Quaternion.identity);
    }
    ```

4.  **Верните объект в пул**: Когда объект больше не нужен, вызовите статический метод `Release()`.
    ```csharp
    void OnCollisionEnter(Collision collision)
    {
        // Возвращаем объект обратно в пул
        PoolManager.Release(this.gameObject);
    }
    ```

**Важно:** Для максимальной эффективности убедитесь, что на компонентах ваших префабов реализован интерфейс `IPoolable`. Это позволит им корректно сбрасывать свое состояние при повторном использовании. (См. документацию `IPoolable.md`)
