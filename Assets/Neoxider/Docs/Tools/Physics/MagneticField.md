# MagneticField

Магнитное поле, которое притягивает или отталкивает объекты в радиусе. Идеально подходит для создания магнитных эффектов, сбора предметов, защитных полей и других интерактивных элементов.

## Возможности

- Притяжение или отталкивание объектов в радиусе
- Постоянное воздействие на объекты
- Фильтрация по слоям
- Опциональное добавление Rigidbody
- Затухание силы по расстоянию
- Режимы: притяжение, отталкивание, переключение, к цели/точке, по направлению
- События при входе/выходе объектов

## Настройки

### Настройки поля

- **Mode**: Режим работы поля
  - `Attract` - притяжение объектов к себе
  - `Repel` - отталкивание объектов
  - `Toggle` - переключение между притяжением и отталкиванием
  - `ToTarget` - притяжение к Transform цели
  - `ToPoint` - притяжение к точке в пространстве
  - `Direction` - притяжение по направлению (вектор)
- **Field Strength**: Сила магнитного поля
- **Radius**: Радиус действия поля
- **Falloff Type**: Тип затухания силы по расстоянию
  - `Linear` - линейное затухание
  - `Quadratic` - квадратичное затухание
  - `Constant` - без затухания

### Режим Toggle

- **Attract Duration**: Время притяжения в режиме Toggle (секунды)
- **Repel Duration**: Время отталкивания в режиме Toggle (секунды)
- **Start With Attract**: Начальный режим для Toggle (true = начинать с притяжения, false = с отталкивания)

### Цель притяжения

- **Target Transform**: Transform цели (используется при режиме ToTarget)
- **Target Point**: Точка в пространстве (используется при режиме ToPoint)

### Направление притяжения (Direction)

- **Direction**: Вектор направления (используется при режиме Direction)
- **Direction Is Local**: Если включено — Direction задаётся в локальных координатах объекта
- **Direction Gizmo Distance**: Длина визуализации направления в сцене (и точка‑ручка для редактирования)

### Фильтрация

- **Affected Layers**: Слои объектов, на которые будет воздействовать поле

### Опции

- **Add Rigidbody If Needed**: Автоматически добавлять Rigidbody на объекты без физики
- **Use Fixed Update**: Использовать FixedUpdate вместо Update для более стабильной физики
- **Update Interval**: Интервал обновления объектов в поле (0 = каждый кадр)

## События

- **OnObjectEntered**: Вызывается при входе объекта в поле (GameObject)
- **OnObjectExited**: Вызывается при выходе объекта из поля (GameObject)
- **OnModeChanged**: Вызывается при изменении режима в Toggle (bool: true = притяжение, false = отталкивание)

## API

### Методы

```csharp
// Переключить режим поля (Attract/Repel)
void ToggleMode()

// Установить режим поля
void SetMode(FieldMode newMode)

// Установить силу поля
void SetStrength(float newStrength)

// Установить радиус поля
void SetRadius(float newRadius)

// Установить цель притяжения (Transform)
void SetTarget(Transform target)

// Установить точку притяжения
void SetTargetPoint(Vector3 point)

// Установить направление притяжения (вектор)
void SetDirection(Vector3 newDirection, bool local = true)

// Установить время притяжения для режима Toggle
void SetAttractDuration(float duration)

// Установить время отталкивания для режима Toggle
void SetRepelDuration(float duration)

// Сбросить таймер режима Toggle (начать цикл заново)
void ResetToggleTimer()
```

### Свойства

```csharp
// Текущая сила поля
float CurrentStrength { get; }

// Текущий радиус поля
float CurrentRadius { get; }

// Количество объектов в поле
int ObjectsInFieldCount { get; }

// Текущее активное состояние в режиме Toggle (true = притяжение, false = отталкивание)
bool CurrentToggleState { get; }
```

## Примеры использования

### Магнит для сбора предметов

1. Создайте GameObject с компонентом `MagneticField`
2. Установите `Mode` на `Attract`
3. Настройте `Field Strength` и `Radius`
4. Настройте `Affected Layers` (например, только слой "Items")
5. Включите `Use Fixed Update` для стабильности

### Защитное поле (отталкивание)

1. Создайте GameObject с компонентом `MagneticField`
2. Установите `Mode` на `Repel`
3. Настройте силу и радиус
4. Объекты будут отталкиваться от центра поля

### Притягиватель к цели

1. Создайте GameObject с компонентом `MagneticField`
2. Установите `Mode` на `ToTarget`
3. Назначьте `Target Transform` (например, камера игрока)
4. Объекты в радиусе поля (вокруг магнита) будут притягиваться к цели

### Притягиватель к точке

1. Создайте GameObject с компонентом `MagneticField`
2. Установите `Mode` на `ToPoint`
3. Установите `Target Point` (координаты в пространстве)
4. Объекты в радиусе поля (вокруг магнита) будут притягиваться к этой точке

### Притягивание по направлению (Direction)

1. Создайте GameObject с компонентом `MagneticField`
2. Установите `Mode` на `Direction`
3. Задайте `Direction` (например, `(0, 1, 0)` чтобы тянуть вверх)
4. При необходимости включите `Direction Is Local`, чтобы направление следовало за поворотом объекта
5. Объекты в радиусе поля будут получать силу в этом направлении

### Пульсирующее поле (Toggle)

1. Установите `Mode` на `Toggle`
2. Настройте `Attract Duration` и `Repel Duration` (например, 3 секунды притяжение, 1 секунда отталкивание)
3. Установите `Start With Attract` (с чего начинать)
4. Поле будет автоматически переключаться между притяжением и отталкиванием с заданными интервалами
5. Используйте событие `OnModeChanged` для реакции на переключение режима

### Динамическое управление

```csharp
MagneticField field = GetComponent<MagneticField>();
field.SetStrength(20f); // Увеличить силу
field.SetRadius(10f); // Увеличить радиус
field.ToggleMode(); // Переключить режим (Attract/Repel)

// Управление режимом Toggle
field.SetAttractDuration(5f); // Установить время притяжения
field.SetRepelDuration(2f); // Установить время отталкивания
field.ResetToggleTimer(); // Сбросить таймер и начать цикл заново
bool isAttracting = field.CurrentToggleState; // Проверить текущее состояние
```

### Оптимизация производительности

1. Установите `Update Interval` (например, 0.1 секунды)
2. Поле будет обновляться реже, что снизит нагрузку
3. Полезно для полей с большим радиусом

## Визуализация

В режиме редактирования (при выборе объекта) отображается:
- Синяя сфера (Attract) или красная сфера (Repel) - радиус поля
- Полупрозрачная сфера - область воздействия
- В режиме Toggle цвет меняется в зависимости от текущего состояния (синий = притяжение, красный = отталкивание)
- В режимах `ToTarget`/`ToPoint` рисуется линия от магнита к цели/точке
- В режиме `Direction` рисуется линия направления и точка на расстоянии `Direction Gizmo Distance`

### Редактирование в сцене

- В режиме `ToPoint` точку можно перемещать прямо в Scene View через handle.
- В режиме `Direction` можно перемещать конец вектора (handle) — направление и длина обновляются автоматически.

## Примечания

- Компонент работает только с 3D физикой
- Рекомендуется использовать `Use Fixed Update` для стабильной физики
- Для объектов без Rigidbody можно включить `Add Rigidbody If Needed`
- Квадратичное затухание создает более естественный эффект
- Объекты автоматически отслеживаются при входе/выходе из поля
- В режиме Toggle время притяжения и отталкивания настраивается независимо
- Событие `OnModeChanged` вызывается только в режиме Toggle при переключении состояния
- Используйте `ResetToggleTimer()` для синхронизации нескольких полей или перезапуска цикла


