# Компонент Leaderboard

## 1. Введение

`Leaderboard` — это главный компонент для создания и управления фейковой таблицей лидеров. Его основная задача — сгенерировать список вымышленных соперников со случайными именами и очками, добавить в этот список реального игрока и отобразить все это в виде отсортированного рейтинга. 

Это мощный инструмент для однопользовательских игр, позволяющий создать иллюзию многопользовательского соревнования и мотивировать игрока улучшать свои результаты.

**Важно:** Хотя класс наследуется от `Singleton<Leaderboard>`, вы можете использовать несколько экземпляров лидерборда одновременно. Для доступа к синглтону используйте `Leaderboard.I`, для работы с конкретным экземпляром — ссылайтесь на него напрямую.

---

## 2. Структура данных

### SortOrder
Перечисление для направления сортировки:
- `Descending`: По убыванию (больше к меньше) — по умолчанию
- `Ascending`: По возрастанию (меньше к больше)

### LeaderboardUser
Это простой класс, который хранит данные об одном пользователе в таблице.
- `name`: Имя пользователя.
- `score`: Количество очков.
- `id`: Уникальный идентификатор (генерируется автоматически).
- `num`: Позиция в таблице после сортировки.

---

## 3. Описание класса

### Leaderboard
- **Пространство имен**: `Neo.Tools` (наследуется от `Singleton<Leaderboard>`)
- **Путь к файлу**: `Assets/Neoxider/Scripts/Tools/FakeLeaderboard/Leaderboard.cs`

**Описание**
Этот класс является синглтоном и выступает в роли центрального менеджера всей таблицы лидеров. Он отвечает за генерацию данных, их сортировку и создание визуальных элементов в UI. Поддерживает работу с несколькими экземплярами одновременно.

### 3.1. Настройки генерации
- `count`: Общее количество пользователей в таблице (включая фейковых и реального игрока).
- `rangeScore`: Диапазон (min, max), в котором будут генерироваться случайные очки для фейковых пользователей.
- `names`: Массив строк с именами, из которых будут случайно выбираться имена для ботов.
- `sep`: Разделитель, добавляемый между именем и номером при генерации.
- `useNum`: Использовать ли номер в имени фейковых пользователей.
- `formatNum`: Форматировать ли номер (добавлять ведущие нули).
- `useZero`: Добавлять ли ведущие нули к номерам позиций.

### 3.2. Настройки игрока
- `player`: Объект `LeaderboardUser`, представляющий реального игрока. Вы можете изменить его имя по умолчанию в инспекторе.

### 3.3. Настройки UI
- `prefab` (`LeaderboardItem`): Префаб элемента списка. Этот объект будет создан для каждой строки в таблице лидеров.
- `container` (`Transform`): Родительский объект, внутри которого будут создаваться экземпляры префаба.
- `leaderboardItemPlayer`: (Опционально) Отдельный элемент UI для отображения данных игрока вне основного списка.
- `generateLeaderboardOnAwake`: Автоматически генерировать элементы списка при старте.
- `generateLeaderboardItemsOnValidate`: Генерировать элементы списка в редакторе при изменении значений.

### 3.4. Настройки сортировки
- `sortOrder`: Направление сортировки (`SortOrder.Descending` или `SortOrder.Ascending`). По умолчанию — по убыванию.
- `onAwakeSort`: Автоматически сортировать таблицу при старте.

### 3.5. Настройки форматирования счета
- `formatScore`: Форматировать ли счет (добавлять разделители тысяч, например: "1 000" вместо "1000").
- `useTimeFormat`: Использовать ли форматирование времени для отображения счета.
- `timeFormat`: Формат времени для отображения счета (см. `TimeFormat` enum: `Seconds`, `MinutesSeconds`, `HoursMinutesSeconds` и т.д.).
- `timeSeparator`: Разделитель для формата времени (по умолчанию ":").

### 3.6. Настройки сохранения
- `playerSaveKey`: Ключ для сохранения данных игрока в `PlayerPrefs`. Можно изменить для разных лидербордов, чтобы они сохраняли данные независимо. По умолчанию: "LeaderboardPlayer".
  - Сохраняются: имя игрока и счет.
  - Сохранение происходит только при вызове `UpdatePlayerScore()`.
  - Данные загружаются автоматически при старте.

---

## 4. Публичные методы и события

**Публичные методы**
- `UpdatePlayerScore(int score, bool overrideBestScore = false)`: **Основной метод для использования в игре.** Обновляет очки игрока, автоматически сохраняет данные, пересортировывает всю таблицу и обновляет UI.
  - Если `overrideBestScore == false` (по умолчанию), счет будет обновлен только если новый результат лучше текущего с учетом `sortOrder`.
  - Если `overrideBestScore == true`, счет обновляется всегда, без проверки на лучший результат.
- `UpdatePlayerName(string newName)`: Обновляет имя игрока и пересортировывает таблицу (без сохранения).
- `GenerateUserList()`: Принудительно генерирует список фейковых пользователей заново.
- `Sort()`: Принудительно запускает сортировку и обновление UI.
- `GetIdPlayer()`: Возвращает текущую позицию (индекс) игрока в отсортированном списке.
- `GetId(LeaderboardUser user)`: Возвращает позицию указанного пользователя в отсортированном списке.
- `FormatScore(int score)`: Форматирует счет согласно настройкам (форматирование чисел или времени).
- `FormatText(int num)`: Форматирует номер позиции с учетом настроек.

**Unity Events**
- `OnSort`: Событие, которое вызывается каждый раз после завершения сортировки таблицы.

---

## 5. Примеры использования

### Базовое использование (синглтон)
```csharp
// Обновить счет игрока (только если новый результат лучше текущего)
Leaderboard.I.UpdatePlayerScore(1500);

// Принудительно перезаписать счет независимо от того, лучше он или хуже
Leaderboard.I.UpdatePlayerScore(1500, true);

// Обновить имя игрока
Leaderboard.I.UpdatePlayerName("MyPlayer");

// Получить позицию игрока
int position = Leaderboard.I.GetIdPlayer();
```

### Использование нескольких лидербордов
```csharp
// Создайте несколько экземпляров Leaderboard на сцене
public Leaderboard dailyLeaderboard;
public Leaderboard weeklyLeaderboard;

// Работайте с конкретным лидербордом
dailyLeaderboard.UpdatePlayerScore(100);
weeklyLeaderboard.UpdatePlayerScore(200);
```

### Настройка форматирования
```csharp
// Включить форматирование с разделителями
Leaderboard.I.formatScore = true; // "1 000" вместо "1000"

// Использовать формат времени для счета
Leaderboard.I.useTimeFormat = true;
Leaderboard.I.timeFormat = TimeFormat.MinutesSeconds; // "05:30"
```

---

## 6. Зависимости

- Наследуется от `Neo.Tools.Singleton<Leaderboard>`.
- Для отображения требует префаб с компонентом `LeaderboardItem`.
- Использует методы расширения `RandomRange()` и `GetRandomElement()` из пространства имен `Neo.Extensions`.
- Использует метод расширения `FormatTime()` для форматирования времени (если включено `useTimeFormat`).
