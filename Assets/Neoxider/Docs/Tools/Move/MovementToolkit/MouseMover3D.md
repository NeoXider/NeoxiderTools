# Компонент Mouse Mover 3D

## 1. Введение

`MouseMover3D` — это 3D-версия компонента `MouseMover2D`. Он решает ключевую задачу: как управлять движением 3D-объекта с помощью 2D-устройства ввода (мыши). Компонент предлагает пять различных режимов управления, от прямого следования за курсором до перемещения в точку на 3D-поверхности, по которой кликнул пользователь.

Это делает его подходящим для самых разных жанров, от RTS и RPG с "point-and-click" управлением до аркад, где объект следует за курсором в определенной плоскости.

---

## 2. Описание класса

### MouseMover3D
- **Пространство имен**: Глобальное
- **Путь к файлу**: `Assets/Neoxider/Scripts/Tools/Move/MovementToolkit/MouseMover3D.cs`

**Описание**
Компонент, который преобразует 2D-координаты и движение мыши в 3D-перемещение объекта с учетом выбранной плоскости, скорости и режима управления.

### 2.1. Режимы движения (Move Mode)
Аналогичны 2D-версии, но адаптированы для 3D:
- `DeltaNormalized` / `DeltaRaw`: Движение объекта отражает движение мыши. Скорость объекта зависит от скорости курсора.
- `MoveToPointHold`: Пока кнопка мыши зажата, объект движется к точке в 3D-пространстве под курсором.
- `ClickToPoint`: Игрок кликает по точке на 3D-поверхности, и объект движется к ней.
- `Direction`: Движение в направлении от точки клика к текущей позиции курсора.

### 2.2. Плоскость движения (Axis Plane)
Это ключевая настройка для 3D-движения. Она определяет, как 2D-движение мыши будет проецироваться в 3D-мир:
- `XZ`: Движение происходит по горизонтальной плоскости (земле). Идеально для стратегий и игр с видом сверху.
- `XY`: Движение происходит по вертикальной плоскости. Подходит для 2D-игр в 3D-пространстве (сайд-скроллеры).
- `YZ`: Движение по боковой плоскости.
- `X`, `Y`, `Z`: Ограничивает движение только одной мировой осью.

### 2.3. Прочие настройки
- `speed`: Скорость движения объекта.
- `groundMask` (`LayerMask`): Маска слоев для рейкаста. Используется в режимах `ClickToPoint` и `MoveToPointHold`, чтобы точно определить, по какой точке на 3D-поверхности (например, на земле) кликнул игрок.
- `mouseButton` (int): Индекс кнопки мыши (0 = левая, 1 = правая, 2 = средняя).
- **Delta-режимы (только для DeltaNormalized / DeltaRaw):**
  - `deltaOnlyWhenButtonHeld` (bool, по умолчанию **true**): если включено, движение по дельте мыши учитывается только при зажатой кнопке мыши; если выключено — объект реагирует на движение мыши постоянно (например, для управления без клика).
  - `invertDeltaX` (bool): инвертировать горизонтальную ось (движение мыши вправо → объект влево).
  - `invertDeltaY` (bool): инвертировать вертикальную ось (движение мыши вверх → объект вниз). Удобно для «инвертированной мыши» в камере или нестандартного управления.
- `arrivalThreshold` (float): Расстояние до цели, при котором движение считается достигнутым (по умолчанию 0.05).

**Камера:** если камера не назначена, в Awake подставляется `Camera.main`; при его отсутствии выводится однократное предупреждение.

**Unity Events**
- `OnMoveStart`: Вызывается, когда объект начинает движение.
- `OnMoveStop`: Вызывается, когда объект останавливается.

---

## 3. Особенности работы

- **Рейкастинг**: Для определения мировой точки под курсором компонент сначала пытается сделать рейкаст по маске `groundMask`. Если он не находит поверхностей, то определяет точку пересечения луча с математической плоскостью, заданной в `AxisPlane`.
- **Rigidbody**: Компонент автоматически определяет наличие `Rigidbody` на объекте и использует `FixedUpdate` для физически корректного перемещения.
- **Интерфейс IMover**: Компонент реализует `IMover`: `MoveDelta(Vector2)` — смещение на плоскости (Vector2 маппится на выбранную плоскость); `MoveToPoint(Vector2)` — телепорт в точку на плоскости (компоненты Vector2 соответствуют осям плоскости).
